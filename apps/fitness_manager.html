<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”¼íŠ¸ë‹ˆìŠ¤ í†µí•© ê´€ë¦¬ì V18 (íŠ¹ìˆ˜í™˜ë¶ˆ íœ´íšŒì°¨ê°)</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c; /* í™˜ë¶ˆ */
            --transfer: #27ae60; /* ì–‘ë„ */
            --upgrade: #673ab7; /* ì—…ê·¸ë ˆì´ë“œ */
            --special: #e65100; /* íŠ¹ìˆ˜ - ì˜¤ë Œì§€ */
            --bg: #f0f2f5;
            --card: #ffffff;
            --border: #ced4da;
            --blue: #2980b9;
        }
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background: var(--bg);
            margin: 0;
            padding: 20px;
            color: #333;
            display: flex;
            justify-content: center;
        }
        .container {
            width: 100%;
            max-width: 700px;
            background: var(--card);
            border-radius: 16px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.08);
            padding: 30px;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-nav {
            display: flex;
            background: #ecf0f1;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 25px;
            gap: 5px;
            flex-wrap: wrap; 
        }
        .tab-btn {
            flex: 1;
            padding: 10px 5px;
            border: none;
            background: transparent;
            font-size: 13px;
            font-weight: bold;
            color: #7f8c8d;
            cursor: pointer;
            border-radius: 8px;
            transition: 0.2s;
            white-space: nowrap;
            min-width: 80px;
        }
        .tab-btn.active.refund { background: white; color: var(--accent); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-btn.active.transfer { background: white; color: var(--transfer); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-btn.active.upgrade { background: white; color: var(--upgrade); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-btn.active.special { background: white; color: var(--special); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* ê³µí†µ ìŠ¤íƒ€ì¼ */
        h2 { text-align: center; margin: 0 0 20px 0; letter-spacing: -1px; }
        
        .section-box {
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #fff;
            position: relative;
        }
        .section-badge {
            position: absolute; top: -12px; left: 15px;
            padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: bold; color: white;
        }
        .badge-refund { background: var(--primary); }
        .badge-transfer { background: var(--transfer); }
        .badge-upgrade { background: var(--upgrade); }
        .badge-special { background: var(--special); }

        .row { display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-end; }
        .col { flex: 1; }
        
        label { display: block; font-size: 13px; font-weight: 700; color: #555; margin-bottom: 6px; }
        
        input:not([type="checkbox"]), select {
            width: 100%; padding: 12px; border: 1px solid var(--border);
            border-radius: 8px; font-size: 15px; box-sizing: border-box; transition: 0.2s;
        }
        input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; margin: 0; accent-color: var(--primary); }
        input:focus { outline: none; border-color: var(--blue); box-shadow: 0 0 0 3px rgba(41, 128, 185, 0.1); }
        input[readonly] { background-color: #f8f9fa; cursor: default; }

        .btn-action {
            width: 100%; padding: 18px; color: white;
            font-size: 18px; font-weight: bold; border: none; border-radius: 10px;
            cursor: pointer; transition: 0.2s; margin-top: 10px;
        }
        .btn-refund { background: var(--primary); }
        .btn-refund:hover { background: #34495e; }
        .btn-transfer { background: var(--transfer); }
        .btn-transfer:hover { background: #219150; }
        .btn-upgrade { background: var(--upgrade); }
        .btn-upgrade:hover { background: #512da8; }
        .btn-special { background: var(--special); }
        .btn-special:hover { background: #e64a19; }

        .btn-reset {
            background: #ecf0f1; border: 1px solid #bdc3c7; color: #7f8c8d;
            padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold;
            position: absolute; right: 30px; top: 30px; z-index: 10;
        }
        .btn-reset:hover { background: #bdc3c7; color: white; }

        .result-area {
            background-color: #fff; border: 2px solid #333;
            border-radius: 12px; padding: 25px; margin-top: 25px; display: none;
        }
        .res-row { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .res-val { font-weight: bold; font-size: 18px; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* í™˜ë¶ˆ ìŠ¤íƒ€ì¼ */
        .pause-area { background: #f3e5f5; border: 1px dashed #ab47bc; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        .calc-log { background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 8px; font-size: 12px; font-family: monospace; max-height: 150px; overflow-y: auto; margin-top: 10px;}
        .option-group { border: 1px solid #eee; padding: 10px; border-radius: 8px; margin-bottom: 8px; background: #fafafa; }
        .option-detail { display: none; margin-top: 10px; border-top: 1px dashed #ddd; padding-top: 10px; }
        .option-group.active { background: #fff; border-color: #bbb; }
        .option-group.active .option-detail { display: block; }

        /* ì–‘ë„/ì—…ê·¸ë ˆì´ë“œ ìŠ¤íƒ€ì¼ */
        .transfer-highlight { color: var(--transfer); font-weight: bold; }
        .upgrade-highlight { color: var(--upgrade); font-weight: bold; }
        .arrow-divider { text-align: center; color: #bbb; font-size: 20px; margin: 10px 0; }
        .pause-adjust-box { background: #e8f5e9; border: 1px solid #c8e6c9; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: none; }
        .pause-adjust-box.active { display: block; }
        .tr-opt-box { background: #f9fbe7; border: 1px solid #dce775; padding: 10px; border-radius: 6px; margin-bottom: 5px; }
        .tr-opt-box.active { background: #f0f4c3; border-color: #c0ca33; }
        .tr-opt-input { display:none; margin-top:5px; }
        
        .flex-label { display: flex; align-items: center; cursor: pointer; margin: 0; width: 100%; }
        .flex-label.between { justify-content: space-between; }
        .flex-label.start { justify-content: flex-start; gap: 8px; }
        .no-wrap { white-space: nowrap; }

        /* ì—…ê·¸ë ˆì´ë“œ ì „ìš© */
        .mode-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; margin-bottom: 10px; }
        .mode-month { background: #e3f2fd; color: #1976d2; border: 1px solid #bbdefb; }
        .mode-standard { background: #ede7f6; color: #673ab7; border: 1px solid #d1c4e9; }
        
        /* íŠ¹ìˆ˜ í™˜ë¶ˆ ì „ìš© */
        .sp-divider { border-top: 2px dashed #ffe0b2; margin: 20px 0; position: relative; }
        .sp-divider::after { content: 'â•'; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: #fff; padding: 0 10px; color: #e65100; font-weight: bold; }
        .editable-month { border: 2px solid #e65100; color: #e65100; font-weight: bold; width: 60px !important; text-align: center; padding: 5px !important; }
        
        .extra-deduct-box { background: #ffebee; border: 1px solid #ffcdd2; padding: 10px; border-radius: 8px; margin-top: 10px; }
        .detail-box { border-top: 1px dashed #ccc; margin: 10px 0; padding: 10px 0; font-size: 13px; color: #555; }
        .detail-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="container">
    <button class="btn-reset" onclick="resetCurrentTab()">ğŸ”„ ì´ˆê¸°í™”</button>
    
    <h2 id="page-title">í”¼íŠ¸ë‹ˆìŠ¤ í†µí•© ê´€ë¦¬ì</h2>

    <!-- íƒ­ ë©”ë‰´ -->
    <div class="tab-nav">
        <button class="tab-btn active refund" onclick="switchTab('refund')">ğŸ’¸ í™˜ë¶ˆ</button>
        <button class="tab-btn transfer" onclick="switchTab('transfer')">ğŸ¤ ì–‘ë„/ì–‘ìˆ˜</button>
        <button class="tab-btn upgrade" onclick="switchTab('upgrade')">âš¡ ì—…ê·¸ë ˆì´ë“œ</button>
        <button class="tab-btn special" onclick="switchTab('special')">âš ï¸ íŠ¹ìˆ˜ í™˜ë¶ˆ</button>
    </div>

    <!-- TAB 1: í™˜ë¶ˆ -->
    <div id="tab-refund" class="tab-content active">
        <!-- ê¸°ì¡´ í™˜ë¶ˆ ì½”ë“œ -->
        <div class="section-box">
            <div class="section-badge badge-refund">STEP 1. ê¸°ê°„ ë° íœ´íšŒ ì„¤ì •</div>
            <div class="row">
                <div class="col"><label>ì‹œì‘ì¼</label><input type="date" id="rf-start" onchange="runRefundSim()"></div>
                <div class="col"><label>í•´ì§€ì¼</label><input type="date" id="rf-end" onchange="runRefundSim()"></div>
            </div>
            <div class="pause-area">
                <label style="color:#8e44ad;">â¸ íœ´íšŒ ê¸°ê°„ (ì„ íƒ)</label>
                <div class="row" style="margin-bottom:0;">
                    <div class="col"><input type="date" id="rf-p-start" onchange="runRefundSim()"><div style="font-size:11px; color:#666;">ì‹œì‘ì¼</div></div>
                    <div class="col"><input type="date" id="rf-p-end" onchange="runRefundSim()"><div style="font-size:11px; color:#666;">ì¢…ë£Œì¼</div></div>
                </div>
            </div>
            <div class="calc-log" id="rf-log">ğŸ“… ë‚ ì§œë¥¼ ì…ë ¥í•˜ë©´ íšŒì°¨ ê³„ì‚° ë¡œê·¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
            <input type="hidden" id="rf-used-months" value="0">
        </div>
        <div class="section-box">
            <div class="section-badge badge-refund" style="background:var(--accent);">STEP 2. ê¸ˆì•¡ ë° ì˜µì…˜</div>
            <div class="row">
                <div class="col"><label>íšŒì›ê¶Œ (ì •ìƒê°€ ìë™)</label><select id="rf-type" onchange="setRefundPreset()"><option value="H3">H 3ê°œì›”</option><option value="H6">H 6ê°œì›”</option><option value="H12">H 12ê°œì›”</option><option value="HG3">HG 3ê°œì›”</option><option value="HG6">HG 6ê°œì›”</option><option value="HG12">HG 12ê°œì›”</option></select></div>
                <div class="col"><label>ì›” ì •ìƒê°€</label><input type="number" id="rf-norm-price" value="156000"></div>
            </div>
            <div class="row"><div class="col"><label>ì‹¤ì œ ê²°ì œ ê¸ˆì•¡</label><input type="number" id="rf-paid" placeholder="í• ì¸ê°€ ì…ë ¥"></div></div>
            <hr style="border:0; border-top:1px dashed #ddd; margin:15px 0;">
            <div class="option-group" id="grp-lk"><label class="flex-label between"><span class="no-wrap" style="font-size:13px; font-weight:bold;">ê°œì¸ë½ì¹´</span><input type="checkbox" id="chk-lk" onchange="toggleOpt('lk')"></label><div class="option-detail"><div class="row"><div class="col"><input type="number" id="pay-lk" placeholder="ê²°ì œì•¡"></div><div class="col"><input type="number" id="norm-lk" value="10000"></div></div></div></div>
            <div class="option-group" id="grp-gf"><label class="flex-label between"><span class="no-wrap" style="font-size:13px; font-weight:bold;">ê³¨í”„ë½ì¹´</span><input type="checkbox" id="chk-gf" onchange="toggleOpt('gf')"></label><div class="option-detail"><div class="row"><div class="col"><input type="number" id="pay-gf" placeholder="ê²°ì œì•¡"></div><div class="col"><input type="number" id="norm-gf" value="20000"></div></div></div></div>
            <div class="option-group" id="grp-un"><label class="flex-label between"><span class="no-wrap" style="font-size:13px; font-weight:bold;">ìš´ë™ë³µ</span><input type="checkbox" id="chk-un" onchange="toggleOpt('un')"></label><div class="option-detail"><div class="row"><div class="col"><input type="number" id="pay-un" placeholder="ê²°ì œì•¡"></div><div class="col"><input type="number" id="norm-un" value="10000"></div></div></div></div>
            <div class="extra-deduct-box">
                <label class="flex-label start" style="margin-bottom:5px;"><input type="checkbox" id="chk-deduct-gift" onchange="calcRefund()"><span style="color:#c62828;">ğŸ ì‚¬ì€í’ˆ ê³µì œ (-50,000ì›)</span></label>
                <label class="flex-label start"><input type="checkbox" id="chk-deduct-ot" onchange="calcRefund()"><span style="color:#c62828;">ğŸ’ª PT(OT) ê³µì œ (-50,000ì›)</span></label>
            </div>
        </div>
        <button class="btn-action btn-refund" onclick="calcRefund()">ğŸ’³ ì¹´ë“œ í™˜ë¶ˆ ê³„ì‚°í•˜ê¸°</button>
        <div class="result-area" id="res-refund">
            <h3 style="margin-top:0; text-align:center; border-bottom:1px solid #eee; padding-bottom:10px;">í™˜ë¶ˆ ëª…ì„¸ì„œ</h3>
            <div class="res-row"><span style="color:#2980b9;">1. ì „ì²´ ì·¨ì†Œ ê¸ˆì•¡</span><span class="res-val" id="val-cancel">0ì›</span></div>
            <div class="res-row"><span style="color:#c0392b;">2. ì¬ê²°ì œ ê¸ˆì•¡ (ê³µì œ ì´ì•¡)</span><span class="res-val" id="val-repay">0ì›</span></div>
            <div class="detail-box">
                <div class="detail-row"><span>ã„´ ì´ ìœ„ì•½ê¸ˆ (10%)</span><span id="dtl-rf-penalty">0</span></div>
                <div class="detail-row"><span>ã„´ íšŒì›ê¶Œ ì´ìš©ë£Œ</span><span id="dtl-rf-usage">0</span></div>
                <div class="detail-row" id="row-rf-opt" style="display:none;"><span>ã„´ ì˜µì…˜ ì´ìš©ë£Œ</span><span id="dtl-rf-opt">0</span></div>
                <div class="detail-row" id="row-rf-extra" style="display:none; color:#c62828;"><span>ã„´ ê¸°íƒ€ ê³µì œ(ì‚¬ì€í’ˆ/OT)</span><span id="dtl-rf-extra">0</span></div>
            </div>
            <div style="background:#f8f9fa; padding:10px; margin-top:5px; border-radius:5px; font-size:12px; color:#555;" id="script-refund"></div>
        </div>
    </div>

    <!-- TAB 2: ì–‘ë„ -->
    <div id="tab-transfer" class="tab-content">
        <!-- ê¸°ì¡´ ì–‘ë„ ì½”ë“œ ìœ ì§€ -->
        <div class="section-box">
            <div class="section-badge badge-transfer">STEP 1. ì–‘ë„ì ì”ì—¬ì¼</div>
            <div class="row"><div class="col"><label>ì–‘ë„ ê¸°ì¤€ì¼</label><input type="date" id="tr-date" onchange="calcTransferDays()"></div></div>
            <div style="border-left:4px solid #2ecc71; padding-left:10px; margin-bottom:15px;">
                <label style="margin-bottom:5px;">íšŒì›ê¶Œ ì „ì‚° ë§Œë£Œì¼</label>
                <div class="row" style="margin-bottom:5px;"><div class="col"><input type="date" id="tr-old-end" onchange="calcTransferDays()"></div></div>
                <label class="flex-label start" style="margin-bottom: 5px;"><input type="checkbox" id="chk-pause-adjust" onchange="togglePauseAdjust()"> <span style="font-size:13px; color:#2e7d32;">â• íœ´íšŒ ë¯¸ë°˜ì˜ ë³´ì •</span></label>
                <div id="pause-adjust-area" class="pause-adjust-box" style="margin-top:5px;"><div class="row" style="margin:0;"><div class="col"><input type="number" id="tr-pause-days" placeholder="íœ´íšŒ ì¼ìˆ˜" oninput="calcTransferDays()"></div></div></div>
                <div class="row" style="margin-top:10px; align-items:center;"><div class="col"><label>ë‚¨ì€ íœ´íšŒ íšŸìˆ˜</label><input type="number" id="tr-pause-count" placeholder="ì˜ˆ: 1"></div><div class="col" style="padding-bottom:10px; font-size:12px; color:#666;">* ì–‘ìˆ˜ì ìŠ¹ê³„ ì‹œ ê¸°ì¬ë¨</div></div>
                <div style="margin-top:10px; font-size:14px; border-top:1px dashed #eee; padding-top:10px;">ğŸ‘‰ íšŒì›ê¶Œ ì”ì—¬: <strong id="tr-remain-days" style="color:#2ecc71; font-size:16px;">0</strong>ì¼</div>
            </div>
            <div style="border-top:1px dashed #ddd; padding-top:10px;">
                <label style="margin-bottom:8px;">ì˜µì…˜ ìƒí’ˆ ì–‘ë„ (ì„ íƒ)</label>
                <div class="tr-opt-box" id="box-tr-lk"><label class="flex-label between"><span class="no-wrap">ğŸ”’ ê°œì¸ë½ì¹´</span><input type="checkbox" id="chk-tr-lk" onchange="toggleTrOpt('lk')"></label><div class="tr-opt-input" id="inp-tr-lk"><label style="font-size:11px;">í˜„ì¬ ë§Œë£Œì¼</label><input type="date" id="end-tr-lk"></div></div>
                <div class="tr-opt-box" id="box-tr-gf"><label class="flex-label between"><span class="no-wrap">â›³ ê³¨í”„ë½ì¹´</span><input type="checkbox" id="chk-tr-gf" onchange="toggleTrOpt('gf')"></label><div class="tr-opt-input" id="inp-tr-gf"><label style="font-size:11px;">í˜„ì¬ ë§Œë£Œì¼</label><input type="date" id="end-tr-gf"></div></div>
                <div class="tr-opt-box" id="box-tr-un"><label class="flex-label between"><span class="no-wrap">ğŸ‘• ìš´ë™ë³µ</span><input type="checkbox" id="chk-tr-un" onchange="toggleTrOpt('un')"></label><div class="tr-opt-input" id="inp-tr-un"><label style="font-size:11px;">í˜„ì¬ ë§Œë£Œì¼</label><input type="date" id="end-tr-un"></div></div>
            </div>
        </div>
        <div class="arrow-divider">â¬‡ ì–‘ìˆ˜ìì—ê²Œ ìŠ¹ê³„ â¬‡</div>
        <div class="section-box">
            <div class="section-badge badge-transfer" style="background:#2ecc71;">STEP 2. ì–‘ìˆ˜ì ì¼ì •</div>
            <div class="row"><div class="col"><label>ì–‘ìˆ˜ì ì‹œì‘ì¼</label><input type="date" id="tr-new-start"></div><div class="col"><label>ì–‘ë„ë¹„ (ê³ ì • 5ë§Œì›)</label><input type="number" id="tr-fee" value="50000"></div></div>
        </div>
        <button class="btn-action btn-transfer" onclick="calcTransferResult()">ğŸ¤ ì–‘ë„ ì²˜ë¦¬ ë° ê²°ê³¼ë³´ê¸°</button>
        <div class="result-area" id="res-transfer">
            <h3 style="margin-top:0; text-align:center; color:var(--transfer);">ì–‘ë„/ì–‘ìˆ˜ í™•ì • ì •ë³´</h3>
            <div class="res-row" style="border-bottom:2px solid #eee; padding-bottom:5px; margin-bottom:10px;"><span>ì–‘ìˆ˜ì ì‹œì‘ì¼</span><span class="res-val" id="res-tr-start">-</span></div>
            <div id="transfer-result-list"></div>
            <div style="background:#f1f8e9; padding:15px; margin-top:15px; border-radius:8px; font-size:13px; color:#33691e; line-height:1.5;">
                <strong>[ì•ˆë‚´ ë©˜íŠ¸]</strong><br>
                ì–‘ë„ìë‹˜ì˜ ì”ì—¬ ê¸°ê°„ <strong id="txt-remain">0ì¼</strong>(íœ´íšŒë³´ì • í¬í•¨)ì„ ì–‘ìˆ˜ìë‹˜ê»˜ ìŠ¹ê³„í•©ë‹ˆë‹¤.<br>
                ì–‘ìˆ˜ìë‹˜ì€ <strong><span id="txt-start">0000-00-00</span></strong>ë¶€í„° ì´ìš©í•˜ì‹œê²Œ ë˜ë©°,<br>
                íšŒì›ê¶Œ ë° ê° ì˜µì…˜ì˜ ë§Œë£Œì¼ì€ ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤.<br>
                <strong style="display:block; margin-top:5px;">íšŒì›ê¶Œ ìµœì¢… ë§Œë£Œì¼: <span id="txt-end">0000-00-00</span></strong>
                <div id="txt-fee-area" style="margin-top:8px; border-top:1px dashed #a5d6a7; padding-top:8px;">* ì–‘ë„ë¹„ <span id="txt-fee" style="font-weight:bold;">50,000ì›</span> ê²°ì œ í•„ìš”</div>
            </div>
        </div>
    </div>

    <!-- TAB 3: ì—…ê·¸ë ˆì´ë“œ -->
    <div id="tab-upgrade" class="tab-content">
        <!-- ê¸°ì¡´ ì—…ê·¸ë ˆì´ë“œ ì½”ë“œ -->
        <div class="section-box">
            <div class="section-badge badge-upgrade">STEP 1. ê¸°ì¡´ íšŒì›ê¶Œ ìƒíƒœ</div>
            <div class="row"><div class="col"><label>ê¸°ì¡´ ì‹œì‘ì¼</label><input type="date" id="up-start" onchange="calcUpgradeMetrics()"></div><div class="col"><label>ê¸°ì¡´ ë§Œë£Œì¼</label><input type="date" id="up-end" onchange="calcUpgradeMetrics()"></div></div>
            <div class="row" style="background:#f3e5f5; padding:10px; border-radius:8px; margin-bottom:10px;"><div class="col"><label style="color:#673ab7;">í”„ë¡œëª¨ì…˜ ë¬´ë£Œ ê¸°ê°„ (ì¼)</label><input type="number" id="up-service-days" value="0" placeholder="0" oninput="calcUpgradeMetrics()"><div style="font-size:11px; color:#666; margin-top:3px;">* ë¬´ë£Œ ê¸°ê°„ì€ ê°€ì… ì´ˆê¸°ì— ìš°ì„  ì†Œì§„(ì°¨ê°)ë©ë‹ˆë‹¤.</div></div></div>
            <div class="row"><div class="col"><label>ê¸°ì¡´ ê²°ì œ ê¸ˆì•¡</label><input type="number" id="up-paid" placeholder="ì˜ˆ: 660000"></div></div>
            <div id="up-status-box" style="margin-top:10px; display:none;"><div id="up-mode-badge" class="mode-badge mode-standard"></div><div style="font-size:14px; line-height:1.6;">ê²½ê³¼ì¼: <span id="up-used-days">0</span>ì¼ / ì´ ì”ì—¬: <span id="up-total-remain">0</span>ì¼<br><span style="color:#673ab7;">(ì´ë¯¸ ì†Œì§„ëœ ë¬´ë£Œê¸°ê°„ ì œì™¸)</span><br>ğŸ‘‰ <strong>ìœ ë£Œ ì”ì—¬ì¼: <span id="up-billable-days" style="color:#673ab7; font-size:18px;">0</span>ì¼</strong></div></div>
        </div>
        <div class="arrow-divider" style="color:#673ab7;">â¬‡ ì°¨ì•¡ ê³„ì‚° â¬‡</div>
        <div class="section-box">
            <div class="section-badge badge-upgrade" style="background:#9575cd;">STEP 2. ì‹ ê·œ ìƒí’ˆ ì •ë³´</div>
            <div class="row"><div class="col"><label>ì‹ ê·œ íšŒì›ê¶Œ ì •ìƒê°€</label><input type="number" id="up-new-price" placeholder="ì˜ˆ: 990000"></div></div>
            <div id="up-discount-area" style="display:none; background:#e8eaf6; padding:10px; border-radius:6px; margin-top:5px;"><label class="flex-label start"><input type="checkbox" id="chk-up-discount" onchange="calcUpgradeCost()"> <span style="color:#3f51b5;">ê´€ë¦¬ì ìŠ¹ì¸ 20% í• ì¸ ì ìš© (6ê°œì›” ë¯¸ë§Œ)</span></label></div>
        </div>
        <button class="btn-action btn-upgrade" onclick="calcUpgradeCost()">âš¡ ì°¨ì•¡ ê³„ì‚°í•˜ê¸°</button>
        <div class="result-area" id="res-upgrade">
            <h3 style="margin-top:0; text-align:center; color:var(--upgrade);">ë³€ê²½(ì—…ê·¸ë ˆì´ë“œ) ëª…ì„¸ì„œ</h3>
            <div id="up-calc-detail" style="font-size:12px; color:#555; background:#f5f5f5; padding:10px; border-radius:6px; margin-bottom:15px; display:none;"><strong>[ê³„ì‚°ì‹ ìƒì„¸]</strong><br>A (ìƒˆ í•˜ë£¨ì¹˜): <span id="val-a">0</span>ì›<br>B (í—Œ í•˜ë£¨ì¹˜): <span id="val-b">0</span>ì›<br>ì°¨ì•¡ (A-B) Ã— <span id="val-days">0</span>ì¼ = <span id="val-res">0</span>ì›</div>
            <div class="res-row"><span class="upgrade-highlight" style="font-size:20px;">ìµœì¢… ê²°ì œ ì°¨ì•¡</span><span class="res-val upgrade-highlight" style="font-size:24px;" id="res-up-final">0ì›</span></div>
            <div style="background:#f3e5f5; padding:15px; margin-top:15px; border-radius:8px; font-size:13px; color:#4a148c; line-height:1.5;"><strong>[ì•ˆë‚´ ë©˜íŠ¸]</strong><br><span id="txt-up-method">ì •ì±…ì— ë”°ë¼ ì¼í•  ì°¨ì•¡ì„ ê³„ì‚°í•˜ì˜€ìŠµë‹ˆë‹¤.</span><br>ê¸°ì¡´ ë‚©ë¶€ì•¡ê³¼ì˜ ì°¨ì•¡ì¸ <strong><span id="txt-up-final">0ì›</span></strong>ì„ ê²°ì œí•˜ì‹œë©´ ë³€ê²½ ì²˜ë¦¬ë©ë‹ˆë‹¤.</div>
        </div>
    </div>

    <!-- TAB 4: íŠ¹ìˆ˜(ë³µí•©) í™˜ë¶ˆ -->
    <div id="tab-special" class="tab-content">
        <!-- ê¸°ì¡´ íŠ¹ìˆ˜ í™˜ë¶ˆ ì½”ë“œ -->
        <div style="background:#fff3e0; padding:10px; border-radius:8px; margin-bottom:20px; font-size:13px; color:#e65100; border:1px solid #ffe0b2;">
            <strong>ğŸ“¢ ì‚¬ìš©ë²•:</strong> ë‚ ì§œ ì…ë ¥ ì‹œ 1ì°¨ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.<br>â€» íŒ€ì¥ë‹˜ ì¬ëŸ‰ì´ë‚˜ ê·œê²© ì™¸ ìƒí™© ì‹œ <strong>ê°œì›” ìˆ˜ë¥¼ ì§ì ‘ ìˆ˜ì •</strong>í•˜ì„¸ìš”.<br>â€» íœ´íšŒ ê¸°ê°„ ì…ë ¥ ì‹œ ìë™ìœ¼ë¡œ ê°œì›” ìˆ˜ì—ì„œ ì°¨ê°ë©ë‹ˆë‹¤.
        </div>
        <div class="section-box">
            <div class="section-badge badge-special">êµ¬ê°„ A: íšŒì›ê¶Œ ë³€ê²½ ì „ (ê³¼ê±°)</div>
            <div class="row"><div class="col"><label>ìµœì´ˆ ì‹œì‘ì¼</label><input type="date" id="sp-start" onchange="runSpecialSim()"></div><div class="col"><label>ë³€ê²½(ì—…ê·¸ë ˆì´ë“œ)ì¼</label><input type="date" id="sp-change" onchange="runSpecialSim()"></div></div>
            <div class="row"><div class="col"><label>ë‹¹ì‹œ íšŒì›ê¶Œ (ì •ìƒê°€ ê¸°ì¤€)</label><select id="sp-type-a" onchange="calcSpecialCost()"><option value="H12">H 12ê°œì›” (ì›” 117,000)</option><option value="H6">H 6ê°œì›” (ì›” 143,000)</option><option value="H3">H 3ê°œì›” (ì›” 156,000)</option><option value="HG12">HG 12ê°œì›” (ì›” 181,000)</option><option value="HG6">HG 6ê°œì›” (ì›” 230,000)</option><option value="HG3">HG 3ê°œì›” (ì›” 283,000)</option></select></div></div>
            <div class="row" style="background:#fff3e0; padding:8px; border-radius:6px; margin-top:5px;"><div class="col"><label style="font-size:12px; color:#e65100;">Aêµ¬ê°„ íœ´íšŒ (ì¼)</label><input type="number" id="sp-pause-a" placeholder="ì¼ìˆ˜ ì…ë ¥" style="height:35px; font-size:14px;" oninput="runSpecialSim()"></div></div>
        </div>
        <div class="sp-divider"></div>
        <div class="section-box">
            <div class="section-badge badge-special" style="background:#ef6c00;">êµ¬ê°„ B: íšŒì›ê¶Œ ë³€ê²½ í›„ (í˜„ì¬)</div>
            <div class="row"><div class="col"><label>ë³€ê²½ì¼ (ìë™ì…ë ¥)</label><input type="text" id="sp-change-display" readonly placeholder="êµ¬ê°„ A ì…ë ¥ ì‹œ ìë™"></div><div class="col"><label>í™˜ë¶ˆ ìš”ì²­ì¼ (ì˜¤ëŠ˜)</label><input type="date" id="sp-end" onchange="runSpecialSim()"></div></div>
            <div class="row"><div class="col"><label>í˜„ì¬ íšŒì›ê¶Œ (ì •ìƒê°€ ê¸°ì¤€)</label><select id="sp-type-b" onchange="calcSpecialCost()"><option value="HG12">HG 12ê°œì›” (ì›” 181,000)</option><option value="HG6">HG 6ê°œì›” (ì›” 230,000)</option><option value="HG3">HG 3ê°œì›” (ì›” 283,000)</option><option value="H12">H 12ê°œì›” (ì›” 117,000)</option><option value="H6">H 6ê°œì›” (ì›” 143,000)</option><option value="H3">H 3ê°œì›” (ì›” 156,000)</option></select></div></div>
            <div class="row" style="background:#fff3e0; padding:8px; border-radius:6px; margin-top:5px;"><div class="col"><label style="font-size:12px; color:#e65100;">Bêµ¬ê°„ íœ´íšŒ (ì¼)</label><input type="number" id="sp-pause-b" placeholder="ì¼ìˆ˜ ì…ë ¥" style="height:35px; font-size:14px;" oninput="runSpecialSim()"></div></div>
        </div>
        <div class="section-box">
            <div class="section-badge badge-special" style="background:#bf360c;">STEP 3. ê²°ì œ ë° ì˜µì…˜</div>
            <label style="margin-bottom:8px; font-weight:bold; color:#d84315;">ì˜µì…˜ ìƒí’ˆ (ì „ì²´ ê¸°ê°„ ì´ìš©)</label>
            <div class="option-group" id="sp-grp-lk"><label class="flex-label between"><span class="no-wrap" style="font-size:13px; font-weight:bold;">ê°œì¸ë½ì¹´</span><input type="checkbox" id="sp-chk-lk" onchange="toggleSpOpt('lk')"></label><div class="option-detail"><div class="row"><div class="col"><input type="number" id="sp-pay-lk" placeholder="ê²°ì œì•¡" oninput="calcSpecialCost()"></div><div class="col"><input type="number" id="sp-norm-lk" value="10000" oninput="calcSpecialCost()"></div></div></div></div>
            <div class="option-group" id="sp-grp-gf"><label class="flex-label between"><span class="no-wrap" style="font-size:13px; font-weight:bold;">ê³¨í”„ë½ì¹´</span><input type="checkbox" id="sp-chk-gf" onchange="toggleSpOpt('gf')"></label><div class="option-detail"><div class="row"><div class="col"><input type="number" id="sp-pay-gf" placeholder="ê²°ì œì•¡" oninput="calcSpecialCost()"></div><div class="col"><input type="number" id="sp-norm-gf" value="20000" oninput="calcSpecialCost()"></div></div></div></div>
            <div class="option-group" id="sp-grp-un"><label class="flex-label between"><span class="no-wrap" style="font-size:13px; font-weight:bold;">ìš´ë™ë³µ</span><input type="checkbox" id="sp-chk-un" onchange="toggleSpOpt('un')"></label><div class="option-detail"><div class="row"><div class="col"><input type="number" id="sp-pay-un" placeholder="ê²°ì œì•¡" oninput="calcSpecialCost()"></div><div class="col"><input type="number" id="sp-norm-un" value="10000" oninput="calcSpecialCost()"></div></div></div></div>
            
            <div class="extra-deduct-box" style="margin-top:15px; border-color:#ffccbc; background:#fffbe6;">
                <label class="flex-label start" style="margin-bottom:5px;"><input type="checkbox" id="sp-chk-deduct-gift" onchange="calcSpecialCost()"><span style="color:#d84315;">ğŸ ì‚¬ì€í’ˆ ê³µì œ (-50,000ì›)</span></label>
                <label class="flex-label start"><input type="checkbox" id="sp-chk-deduct-ot" onchange="calcSpecialCost()"><span style="color:#d84315;">ğŸ’ª PT(OT) ê³µì œ (-50,000ì›)</span></label>
            </div>
            <hr style="border:0; border-top:1px dashed #ddd; margin:15px 0;">
            <div class="row"><div class="col"><label>â‘  ìµœì´ˆ ê²°ì œê¸ˆì•¡</label><input type="number" id="sp-pay-a" placeholder="ì˜ˆ: 987000" oninput="calcSpecialCost()"></div><div class="col"><label>â‘¡ ì¶”ê°€ ê²°ì œê¸ˆì•¡</label><input type="number" id="sp-pay-b" placeholder="ì˜ˆ: 615600" oninput="calcSpecialCost()"></div></div>
        </div>
        <div class="result-area" id="res-special" style="display:block; border-color:#e65100;">
            <h3 style="margin-top:0; text-align:center; color:#e65100;">ë³µí•© í™˜ë¶ˆ ëª…ì„¸ì„œ</h3>
            <div class="res-row"><span style="color:#2980b9;">ì´ ê²°ì œ í•©ê³„</span><span class="res-val" id="sp-total-paid">0ì›</span></div>
            <div style="border-top:1px dashed #ccc; margin:10px 0; padding:10px 0;">
                <div class="res-row" style="font-size:14px; color:#555;"><span>(-) ìœ„ì•½ê¸ˆ (ì´ì•¡ì˜ 10%)</span><span id="sp-penalty">0ì›</span></div>
                <div class="res-row" style="font-size:14px; color:#d84315; display:none;" id="sp-extra-row"><span>(-) ê¸°íƒ€ ê³µì œ(ì‚¬ì€í’ˆ/OT)</span><span id="sp-extra-deduct">0ì›</span></div>
                <div class="res-row" style="align-items:center; background:#fff3e0; padding:5px; border-radius:5px; margin-bottom:8px;">
                    <span style="font-size:14px; font-weight:bold; color:#e65100;">(-) êµ¬ê°„ A ê³µì œì›”</span>
                    <input type="number" id="sp-months-a" class="editable-month" value="0" oninput="syncOptionMonths()">
                    <span id="sp-deduct-a" style="margin-left:auto;">0ì›</span>
                </div>
                <div class="res-row" style="align-items:center; background:#fff3e0; padding:5px; border-radius:5px; margin-bottom:8px;">
                    <span style="font-size:14px; font-weight:bold; color:#e65100;">(-) êµ¬ê°„ B ê³µì œì›”</span>
                    <input type="number" id="sp-months-b" class="editable-month" value="0" oninput="syncOptionMonths()">
                    <span id="sp-deduct-b" style="margin-left:auto;">0ì›</span>
                </div>
                <div class="res-row" id="sp-opt-row" style="display:none; align-items:center; background:#fff8e1; padding:5px; border-radius:5px;">
                    <span style="font-size:14px; font-weight:bold; color:#f57f17;">(-) ì˜µì…˜ ê³µì œì›”</span>
                    <input type="number" id="sp-months-opt" class="editable-month" style="border-color:#f57f17; color:#f57f17;" value="0" oninput="calcSpecialCost()">
                    <span id="sp-opt-deduct" style="margin-left:auto;">0ì›</span>
                </div>
            </div>
            <div class="res-row"><span style="color:#e65100; font-size:20px;">ìµœì¢… í™˜ë¶ˆ ê¸ˆì•¡</span><span class="res-val" style="color:#e65100; font-size:24px;" id="sp-final">0ì›</span></div>
            <div style="margin-top:15px; font-size:12px; color:#666; background:#fff3e0; padding:10px; border-radius:5px;">* <strong>Tip:</strong> ì£¼í™©ìƒ‰ ë°•ìŠ¤ ì•ˆì˜ ìˆ«ìë¥¼ ìˆ˜ì •í•˜ë©´ ê³µì œ ê¸ˆì•¡ì´ ì¦‰ì‹œ ì¬ê³„ì‚°ë©ë‹ˆë‹¤.<br>* íœ´íšŒ ì¼ìˆ˜ë¥¼ ì…ë ¥í•˜ë©´ í•´ë‹¹ êµ¬ê°„ì˜ ê°œì›” ìˆ˜ê°€ ìë™ ì°¨ê°ë©ë‹ˆë‹¤.</div>
        </div>
    </div>

</div>

<script>
    window.onload = function() {
        resetCurrentTab();
        document.getElementById('sp-change').addEventListener('change', function() {
            document.getElementById('sp-change-display').value = this.value;
        });
        document.getElementById('sp-end').value = new Date().toISOString().substring(0, 10);
    };

    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`.tab-btn.${tab}`).classList.add('active');

        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(`tab-${tab}`).classList.add('active');

        const title = document.getElementById('page-title');
        title.innerText = 'í”¼íŠ¸ë‹ˆìŠ¤ í†µí•© ê´€ë¦¬ì'; 
        if(tab === 'refund') title.style.color = '#2c3e50';
        else if(tab === 'transfer') title.style.color = '#27ae60';
        else if(tab === 'upgrade') title.style.color = '#673ab7';
        else title.style.color = '#e65100'; 
        
        resetCurrentTab();
    }

    function resetCurrentTab() {
        const activeTab = document.querySelector('.tab-content.active').id;
        const today = new Date().toISOString().substring(0, 10);

        if (activeTab === 'tab-refund') {
            document.getElementById('rf-end').value = today;
            document.getElementById('chk-deduct-gift').checked = false;
            document.getElementById('chk-deduct-ot').checked = false;
        } else if (activeTab === 'tab-transfer') {
            document.getElementById('tr-date').value = today;
            document.getElementById('tr-new-start').value = today;
        } else if (activeTab === 'tab-upgrade') {
            // ...
        } else {
            // íŠ¹ìˆ˜ í™˜ë¶ˆ ì´ˆê¸°í™”
            document.getElementById('sp-start').value = '';
            document.getElementById('sp-change').value = '';
            document.getElementById('sp-change-display').value = '';
            document.getElementById('sp-end').value = today;
            document.getElementById('sp-pay-a').value = '';
            document.getElementById('sp-pay-b').value = '';
            document.getElementById('sp-months-a').value = 0;
            document.getElementById('sp-months-b').value = 0;
            document.getElementById('sp-months-opt').value = 0;
            document.getElementById('sp-pause-a').value = '';
            document.getElementById('sp-pause-b').value = '';
            
            ['lk', 'gf', 'un'].forEach(code => {
                document.getElementById('sp-chk-'+code).checked = false;
                document.getElementById('sp-grp-'+code).classList.remove('active');
                document.querySelector('#sp-grp-'+code+' .option-detail').style.display = 'none';
                document.getElementById('sp-pay-'+code).value = '';
            });
            document.getElementById('sp-chk-deduct-gift').checked = false;
            document.getElementById('sp-chk-deduct-ot').checked = false;
            
            calcSpecialCost();
        }
    }

    function fmtNum(n) { return new Intl.NumberFormat('ko-KR').format(Math.floor(n)); }
    function getDiffDays(start, end) { return Math.floor((end - start) / (1000 * 60 * 60 * 24)) + 1; }
    function fmtDate(d) { return `${d.getFullYear()}-${('0'+(d.getMonth()+1)).slice(-2)}-${('0'+d.getDate()).slice(-2)}`; }

    const REFUND_PRESETS = { 'H3': 156000, 'H6': 143000, 'H12': 117000, 'HG3': 283000, 'HG6': 230000, 'HG12': 181000 };

    function setRefundPreset() { document.getElementById('rf-norm-price').value = REFUND_PRESETS[document.getElementById('rf-type').value]; }
    function toggleOpt(id) { const grp = document.getElementById('grp-'+id); document.getElementById('chk-'+id).checked ? grp.classList.add('active') : grp.classList.remove('active'); }
    
    // [V16] ë‚ ì§œ ê³„ì‚° (ë‹¹ì¼ í¬í•¨)
    function runRefundSim() { 
        const sVal = document.getElementById('rf-start').value; const eVal = document.getElementById('rf-end').value;
        if(!sVal || !eVal) return;
        const start = new Date(sVal); const end = new Date(eVal);
        const logBox = document.getElementById('rf-log');
        const psVal = document.getElementById('rf-p-start').value; const peVal = document.getElementById('rf-p-end').value;
        let pStart = psVal ? new Date(psVal) : null; let pEnd = peVal ? new Date(peVal) : null;
        let pDays = (pStart && pEnd && pStart <= pEnd) ? getDiffDays(pStart, pEnd) : 0;
        let logs = [`ğŸ” <strong>íšŒì°¨ ë¶„ì„</strong> (ê°œì‹œ: ${fmtDate(start)})`];
        if(pDays > 0) logs.push(`â¸ íœ´íšŒ: ${fmtDate(pStart)}~${fmtDate(pEnd)} (${pDays}ì¼)`);
        
        let monthCount = 1; let curStart = new Date(start); let finalMonths = 0;
        
        while(true) {
            // [V16 ë³€ê²½ì ] tempEnd calculation: Start + 1 Month (No minus 1 day)
            let tempEnd = new Date(curStart); 
            tempEnd.setMonth(tempEnd.getMonth() + 1); 
            // tempEnd.setDate(tempEnd.getDate() - 1); // ì‚­ì œë¨: ë‹¹ì¼ ì¢…ë£Œ ë¡œì§

            let ext = 0; if (pStart && pEnd && pStart <= tempEnd && pEnd >= curStart) { ext = pDays; }
            let actEnd = new Date(tempEnd); actEnd.setDate(actEnd.getDate() + ext);
            let msg = `${monthCount}íšŒì°¨: ${fmtDate(curStart)} ~ ${fmtDate(actEnd)}`;
            if(ext > 0) msg += ` <span style="color:#e67e22">(+íœ´íšŒ)</span>`;
            
            if (end <= actEnd) {
                logs.push(`<span style="color:#f1c40f; font-weight:bold;">â–¶ ${msg}</span>`);
                logs.push(`âœ… í•´ì§€ì¼ í¬í•¨. <strong>ì´ ${monthCount}ê°œì›” ê³µì œ</strong>`);
                finalMonths = monthCount; break;
            } else {
                logs.push(msg); monthCount++; curStart = new Date(actEnd); curStart.setDate(curStart.getDate() + 1);
                if(monthCount > 36) break;
            }
        }
        logBox.innerHTML = logs.map(l => `<div>${l}</div>`).join('');
        document.getElementById('rf-used-months').value = finalMonths;
    }

    function calcRefund() {
        const months = Number(document.getElementById('rf-used-months').value);
        if(months === 0) { alert("ë‚ ì§œë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
        const paid = Number(document.getElementById('rf-paid').value || 0);
        const norm = Number(document.getElementById('rf-norm-price').value || 0);
        
        let memPenalty = paid * 0.1;
        let memUsage = norm * months;
        let optPaid = 0, optPenalty = 0, optUsage = 0;
        let hasOpt = false;

        ['lk', 'gf', 'un'].forEach(id => {
            if(document.getElementById('chk-'+id).checked) {
                hasOpt = true;
                let p = Number(document.getElementById('pay-'+id).value || 0);
                let n = Number(document.getElementById('norm-'+id).value || 0);
                optPaid += p; 
                optPenalty += p * 0.1;
                optUsage += n * months;
            }
        });
        
        // ì¶”ê°€ ê³µì œ
        let extraDeduct = 0;
        if(document.getElementById('chk-deduct-gift').checked) extraDeduct += 50000;
        if(document.getElementById('chk-deduct-ot').checked) extraDeduct += 50000;

        const totalCancel = paid + optPaid; 
        const totalRepay = (memPenalty + memUsage + optPenalty + optUsage + extraDeduct);
        
        document.getElementById('val-cancel').innerText = fmtNum(totalCancel) + 'ì›';
        document.getElementById('val-repay').innerText = fmtNum(totalRepay) + 'ì›';
        
        // [V17] ìƒì„¸ ë‚´ì—­ í‘œì‹œ
        document.getElementById('dtl-rf-penalty').innerText = fmtNum(memPenalty + optPenalty) + 'ì›';
        document.getElementById('dtl-rf-usage').innerText = fmtNum(memUsage) + 'ì›';
        
        if(hasOpt) {
            document.getElementById('row-rf-opt').style.display = 'flex';
            document.getElementById('dtl-rf-opt').innerText = fmtNum(optUsage) + 'ì›';
        } else {
            document.getElementById('row-rf-opt').style.display = 'none';
        }

        if(extraDeduct > 0) {
            document.getElementById('row-rf-extra').style.display = 'flex';
            document.getElementById('dtl-rf-extra').innerText = fmtNum(extraDeduct) + 'ì›';
        } else {
            document.getElementById('row-rf-extra').style.display = 'none';
        }
        
        let extraMsg = extraDeduct > 0 ? ` + ì¶”ê°€ê³µì œ ${fmtNum(extraDeduct)}ì›` : "";
        document.getElementById('script-refund').innerHTML = `ì „ì²´ ${fmtNum(totalCancel)}ì› ì·¨ì†Œ í›„, ìœ„ì•½ê¸ˆ+ì´ìš©ë£Œ${extraMsg} í•©ê³„ <strong>${fmtNum(totalRepay)}ì›</strong>ì„ ì¬ê²°ì œí•©ë‹ˆë‹¤.`;
        document.getElementById('res-refund').style.display = 'block';
    }

    // [ì–‘ë„, ì—…ê·¸ë ˆì´ë“œ í•¨ìˆ˜ë“¤ - ì´ì „ê³¼ ë™ì¼]
    function togglePauseAdjust() { const box = document.getElementById('pause-adjust-area'); const chk = document.getElementById('chk-pause-adjust'); chk.checked ? box.classList.add('active') : (box.classList.remove('active'), document.getElementById('tr-pause-days').value = '', calcTransferDays()); }
    function toggleTrOpt(code) { const chk = document.getElementById('chk-tr-' + code); const box = document.getElementById('box-tr-' + code); const inp = document.getElementById('inp-tr-' + code); if (chk.checked) { box.classList.add('active'); inp.style.display = 'block'; } else { box.classList.remove('active'); inp.style.display = 'none'; document.getElementById('end-tr-' + code).value = ''; } }
    function calcTransferDays() { const oldEndVal = document.getElementById('tr-old-end').value; const trDateVal = document.getElementById('tr-date').value; if (!oldEndVal || !trDateVal) return; let oldEnd = new Date(oldEndVal); const trDate = new Date(trDateVal); const pauseDays = Number(document.getElementById('tr-pause-days').value || 0); if (pauseDays > 0) { oldEnd.setDate(oldEnd.getDate() + pauseDays); } const diffTime = oldEnd - trDate; let diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1; if (diffDays < 0) diffDays = 0; document.getElementById('tr-remain-days').innerText = diffDays; }
    function calcTransferResult() { 
        const trDateVal = document.getElementById('tr-date').value; const newStartVal = document.getElementById('tr-new-start').value; const memDays = Number(document.getElementById('tr-remain-days').innerText); const pauseCount = document.getElementById('tr-pause-count').value; 
        if (!trDateVal || !newStartVal) { alert("ë‚ ì§œë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
        const trDate = new Date(trDateVal); const newStart = new Date(newStartVal);
        let html = ''; if (memDays > 0) { const memEnd = new Date(newStart); memEnd.setDate(memEnd.getDate() + memDays - 1); html += `<div class="res-row"><span>íšŒì›ê¶Œ (${memDays}ì¼)</span><span class="transfer-highlight">${fmtDate(memEnd)} ì¢…ë£Œ</span></div>`; } else { html += `<div class="res-row" style="color:#888;"><span>íšŒì›ê¶Œ</span><span>ìŠ¹ê³„ ê¸°ê°„ ì—†ìŒ</span></div>`; }
        if (pauseCount && Number(pauseCount) > 0) { html += `<div class="res-row" style="background:#f3e5f5; padding:5px; border-radius:4px; margin-top:-5px; margin-bottom:5px;"><span style="font-size:13px;">ã„´ ë‚¨ì€ íœ´íšŒ</span><span style="font-weight:bold; color:#8e44ad;">${pauseCount}íšŒ ìŠ¹ê³„ë¨</span></div>`; }
        const opts = [{id:'lk', name:'ê°œì¸ë½ì¹´'}, {id:'gf', name:'ê³¨í”„ë½ì¹´'}, {id:'un', name:'ìš´ë™ë³µ'}];
        opts.forEach(opt => { if(document.getElementById('chk-tr-'+opt.id).checked) { const endVal = document.getElementById('end-tr-'+opt.id).value; if(endVal) { const optEnd = new Date(endVal); let optDays = Math.floor((optEnd - trDate) / (1000 * 60 * 60 * 24)) + 1; if(optDays < 0) optDays = 0; if(optDays > 0) { const newOptEnd = new Date(newStart); newOptEnd.setDate(newOptEnd.getDate() + optDays - 1); html += `<div class="res-row"><span>${opt.name} (${optDays}ì¼)</span><span style="font-weight:bold;">${fmtDate(newOptEnd)} ì¢…ë£Œ</span></div>`; } else { html += `<div class="res-row" style="color:#999;"><span>${opt.name}</span><span>ê¸°ê°„ ë§Œë£Œ</span></div>`; } } } });
        const listEl = document.getElementById('transfer-result-list'); if(listEl) listEl.innerHTML = html;
        const resStartEl = document.getElementById('res-tr-start'); if(resStartEl) resStartEl.innerText = fmtDate(newStart);
        const txtStartEl = document.getElementById('txt-start'); if(txtStartEl) txtStartEl.innerText = fmtDate(newStart);
        const txtRemainEl = document.getElementById('txt-remain'); if(txtRemainEl) txtRemainEl.innerText = memDays + 'ì¼';
        const txtEndEl = document.getElementById('txt-end'); if (txtEndEl) { if (memDays > 0) { const finalEnd = new Date(newStart); finalEnd.setDate(finalEnd.getDate() + memDays - 1); txtEndEl.innerText = fmtDate(finalEnd); } else { txtEndEl.innerText = "(íšŒì›ê¶Œ ì—†ìŒ)"; } }
        const fee = Number(document.getElementById('tr-fee').value || 0); const feeArea = document.getElementById('txt-fee-area'); const txtFee = document.getElementById('txt-fee'); if (feeArea && txtFee) { if (fee > 0) { feeArea.style.display = 'block'; txtFee.innerText = fmtNum(fee) + 'ì›'; } else { feeArea.style.display = 'none'; } }
        document.getElementById('res-transfer').style.display = 'block';
    }
    function calcUpgradeMetrics() { /* V11.2 ë¡œì§ */ const sVal = document.getElementById('up-start').value; const eVal = document.getElementById('up-end').value; if(!sVal || !eVal) return; const start = new Date(sVal); const end = new Date(eVal); const today = new Date(); const diffTime = today - start; let usedDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1; if(usedDays < 1) usedDays = 1; const remainingTime = end - today; let totalRemain = Math.floor(remainingTime / (1000 * 60 * 60 * 24)) + 1; if(totalRemain < 0) totalRemain = 0; const serviceDays = Number(document.getElementById('up-service-days').value || 0); const remainingService = Math.max(0, serviceDays - usedDays); const billableRemain = Math.max(0, totalRemain - remainingService); const badge = document.getElementById('up-mode-badge'); const box = document.getElementById('up-status-box'); const discountArea = document.getElementById('up-discount-area'); box.style.display = 'block'; document.getElementById('up-billable-days').dataset.mode = 'standard'; if (usedDays <= 30) { badge.className = 'mode-badge mode-month'; badge.innerText = 'ğŸ“… ê°€ì… 1ê°œì›” ì´ë‚´ (ë‹¨ìˆœ ì°¨ì•¡)'; document.getElementById('up-billable-days').dataset.mode = 'month'; discountArea.style.display = 'none'; } else { badge.className = 'mode-badge mode-standard'; badge.innerText = 'âš¡ ì¼ë°˜ ì—…ê·¸ë ˆì´ë“œ (365ì¼ ê¸°ì¤€)'; if (usedDays < 180) { discountArea.style.display = 'block'; } else { discountArea.style.display = 'none'; document.getElementById('chk-up-discount').checked = false; } } document.getElementById('up-used-days').innerText = usedDays; document.getElementById('up-total-remain').innerText = totalRemain; document.getElementById('up-billable-days').innerText = billableRemain; document.getElementById('up-billable-days').dataset.days = billableRemain; }
    function calcUpgradeCost() { /* V11.2 ë¡œì§ */ const mode = document.getElementById('up-billable-days').dataset.mode; const billableDays = Number(document.getElementById('up-billable-days').dataset.days || 0); let newPrice = Number(document.getElementById('up-new-price').value || 0); const oldPrice = Number(document.getElementById('up-paid').value || 0); if(newPrice === 0) { alert("ì‹ ê·œ ìƒí’ˆ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; } let finalCost = 0; let methodText = ""; let calcDetail = document.getElementById('up-calc-detail'); if (mode === 'month') { finalCost = newPrice - oldPrice; methodText = "ê°€ì… 1ê°œì›” ì´ë‚´ì´ë¯€ë¡œ <strong>ë‹¨ìˆœ ì°¨ì•¡(ê¸°ê°„ ì—°ì¥)</strong>ìœ¼ë¡œ ê³„ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤."; calcDetail.style.display = 'none'; } else { const isDiscount = document.getElementById('chk-up-discount').checked; if (isDiscount) { newPrice = newPrice * 0.8; } const valA = newPrice / 365; const valB = oldPrice / 365; const diffPerDay = valA - valB; finalCost = Math.floor(diffPerDay * billableDays); finalCost = Math.floor(finalCost / 10) * 10; let discountMsg = isDiscount ? "(20% í• ì¸ê°€) " : ""; methodText = `365ì¼ ê¸°ì¤€ ì¼í•  ì°¨ì•¡ ë°©ì‹${discountMsg}ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.<br>(ë¬´ë£Œ ê¸°ê°„ì€ ê°€ì… ì´ˆê¸°ì— ìš°ì„  ì†Œì§„)`; calcDetail.style.display = 'block'; document.getElementById('val-a').innerText = Math.floor(valA); document.getElementById('val-b').innerText = Math.floor(valB); document.getElementById('val-days').innerText = billableDays; document.getElementById('val-res').innerText = fmtNum(finalCost); } if (finalCost < 0) finalCost = 0; document.getElementById('res-up-final').innerText = fmtNum(finalCost) + 'ì›'; document.getElementById('txt-up-final').innerText = fmtNum(finalCost) + 'ì›'; document.getElementById('txt-up-method').innerHTML = methodText; document.getElementById('res-upgrade').style.display = 'block'; }

    // [V15] íŠ¹ìˆ˜(ë³µí•©) í™˜ë¶ˆ ë¡œì§ ìˆ˜ì • - ìˆ˜ë™ ë³´ì • ê¸°ëŠ¥
    function toggleSpOpt(code) {
        const chk = document.getElementById('sp-chk-' + code);
        const grp = document.getElementById('sp-grp-' + code);
        const detail = document.querySelector('#sp-grp-' + code + ' .option-detail');
        
        if (chk.checked) {
            grp.classList.add('active');
            detail.style.display = 'block';
        } else {
            grp.classList.remove('active');
            detail.style.display = 'none';
            document.getElementById('sp-pay-' + code).value = '';
        }
    }

    // [V17] íŠ¹ìˆ˜ í™˜ë¶ˆ ë¡œì§ ë‚ ì§œë„ ë™ì¼í•˜ê²Œ ë³€ê²½ (Cycle)
    function calculateCycleMonths(start, end) {
        let monthCount = 1; 
        let curStart = new Date(start); 
        let finalMonths = 0;
        while(true) {
            let tempEnd = new Date(curStart); 
            tempEnd.setMonth(tempEnd.getMonth() + 1); 
            // tempEnd.setDate(tempEnd.getDate() - 1); // ì‚­ì œë¨
            if (end <= tempEnd) { finalMonths = monthCount; break; } 
            else { monthCount++; curStart = new Date(tempEnd); curStart.setDate(curStart.getDate() + 1); if(monthCount > 36) break; }
        }
        return finalMonths;
    }

    // 1. ë‚ ì§œ ë³€ê²½ ì‹œ -> ì¶”ì²œ ê°œì›”ìˆ˜ ê³„ì‚°í•˜ì—¬ ì¸í’‹ì— ì§‘ì–´ë„£ê¸°
    function runSpecialSim() {
        const sVal = document.getElementById('sp-start').value;
        const changeVal = document.getElementById('sp-change').value;
        const eVal = document.getElementById('sp-end').value;
        
        // [V18] íœ´íšŒ ì¼ìˆ˜ ê°€ì ¸ì˜¤ê¸°
        const pauseA = Number(document.getElementById('sp-pause-a').value || 0);
        const pauseB = Number(document.getElementById('sp-pause-b').value || 0);
        
        if(!sVal || !changeVal || !eVal) return;

        const startDate = new Date(sVal);
        const changeDate = new Date(changeVal);
        const endDate = new Date(eVal);

        // Aê¸°ê°„ ì¢…ë£Œì¼ (ë³€ê²½ì¼ ì „ë‚ )
        const endA = new Date(changeDate);
        endA.setDate(endA.getDate() - 1);
        
        // [V18] Aêµ¬ê°„ ì‹¤ì§ˆ ì¢…ë£Œì¼ ê³„ì‚° (íœ´íšŒ ì°¨ê°)
        const effectiveEndA = new Date(endA);
        effectiveEndA.setDate(effectiveEndA.getDate() - pauseA);

        let monthsA = 0;
        if (effectiveEndA >= startDate) { monthsA = calculateCycleMonths(startDate, effectiveEndA); }

        // [V18] Bêµ¬ê°„ ì‹¤ì§ˆ ì¢…ë£Œì¼ ê³„ì‚° (íœ´íšŒ ì°¨ê°)
        const effectiveEndB = new Date(endDate);
        effectiveEndB.setDate(effectiveEndB.getDate() - pauseB);

        let monthsB = 0;
        if (effectiveEndB >= changeDate) { monthsB = calculateCycleMonths(changeDate, effectiveEndB); }

        document.getElementById('sp-months-a').value = monthsA;
        document.getElementById('sp-months-b').value = monthsB;
        
        // [V17] ì˜µì…˜ ì›” = ì „ì²´ ê¸°ê°„ (Start ~ End) í†µí•© ê³„ì‚°
        // [V18] ì˜µì…˜ ê¸°ê°„ë„ ì´ íœ´íšŒ(A+B)ë§Œí¼ ì°¨ê°
        const totalPause = pauseA + pauseB;
        const effectiveTotalEnd = new Date(endDate);
        effectiveTotalEnd.setDate(effectiveTotalEnd.getDate() - totalPause);
        
        const totalOptionMonths = calculateCycleMonths(startDate, effectiveTotalEnd);
        document.getElementById('sp-months-opt').value = totalOptionMonths;

        calcSpecialCost();
    }
    
    // [V15] A, B ì›” ë³€ê²½ ì‹œ ì˜µì…˜ ì›” ë™ê¸°í™” í•¨ìˆ˜
    function syncOptionMonths() {
        // [V17] ì˜µì…˜ ì›” ìë™ ë™ê¸°í™” ë¡œì§ ì œê±° (ë…ë¦½ì„± ë³´ì¥)
        // ë§Œì•½ A+B í•©ì‚°ìœ¼ë¡œ ì˜µì…˜ ì›”ì„ ê°•ì œí•˜ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ ì£¼ì„ í•´ì œ
        /*
        const monthsA = Number(document.getElementById('sp-months-a').value);
        const monthsB = Number(document.getElementById('sp-months-b').value);
        document.getElementById('sp-months-opt').value = monthsA + monthsB;
        */
        calcSpecialCost();
    }

    // 2. ë¹„ìš© ê³„ì‚°
    function calcSpecialCost() {
        const monthsA = Number(document.getElementById('sp-months-a').value);
        const monthsB = Number(document.getElementById('sp-months-b').value);
        const monthsOpt = Number(document.getElementById('sp-months-opt').value);

        const payA = Number(document.getElementById('sp-pay-a').value || 0);
        const payB = Number(document.getElementById('sp-pay-b').value || 0);
        
        const typeA = document.getElementById('sp-type-a').value;
        const typeB = document.getElementById('sp-type-b').value;
        const normPriceA = REFUND_PRESETS[typeA];
        const normPriceB = REFUND_PRESETS[typeB];

        const deductA = normPriceA * monthsA;
        const deductB = normPriceB * monthsB;
        
        let optPaid = 0;
        let optDeduct = 0;
        
        ['lk', 'gf', 'un'].forEach(code => {
            if(document.getElementById('sp-chk-'+code).checked) {
                const p = Number(document.getElementById('sp-pay-'+code).value || 0);
                const n = Number(document.getElementById('sp-norm-'+code).value || 0);
                optPaid += p;
                optDeduct += (n * monthsOpt);
            }
        });

        let extraDeduct = 0;
        if(document.getElementById('sp-chk-deduct-gift').checked) extraDeduct += 50000;
        if(document.getElementById('sp-chk-deduct-ot').checked) extraDeduct += 50000;

        const totalPaid = payA + payB + optPaid;
        const penalty = totalPaid * 0.1;

        let finalRefund = totalPaid - penalty - deductA - deductB - optDeduct - extraDeduct;
        if (finalRefund < 0) finalRefund = 0;

        document.getElementById('sp-total-paid').innerText = fmtNum(totalPaid) + 'ì›';
        document.getElementById('sp-penalty').innerText = '-' + fmtNum(penalty) + 'ì›';
        
        document.getElementById('sp-deduct-a').innerText = '-' + fmtNum(deductA) + 'ì›';
        document.getElementById('sp-deduct-b').innerText = '-' + fmtNum(deductB) + 'ì›';
        
        if (extraDeduct > 0) {
            document.getElementById('sp-extra-row').style.display = 'flex';
            document.getElementById('sp-extra-deduct').innerText = '-' + fmtNum(extraDeduct) + 'ì›';
        } else {
            document.getElementById('sp-extra-row').style.display = 'none';
        }

        if (optPaid > 0) {
            document.getElementById('sp-opt-row').style.display = 'flex';
            document.getElementById('sp-opt-deduct').innerText = '-' + fmtNum(optDeduct) + 'ì›';
        } else {
            document.getElementById('sp-opt-row').style.display = 'none';
        }
        
        document.getElementById('sp-final').innerText = fmtNum(finalRefund) + 'ì›';
        document.getElementById('res-special').style.display = 'block';
    }
</script>

</body>
</html>